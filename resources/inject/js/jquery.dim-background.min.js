!function(i){"use strict";function n(i,n){return"function"==typeof i&&(n=i,i={}),"object"!=typeof i&&(i={}),"function"!=typeof n&&(n=function(){}),{options:i,callback:n}}var t=[];i.fn.dimBackground=function(a,o){var s=n(a,o);a=s.options,o=s.callback,a=i.extend({},i.fn.dimBackground.defaults,a);var e=i('<div class="dimbackground-curtain"></div>');return e.css({position:"fixed",left:0,top:0,width:"100%",height:"100%",background:"black",opacity:0,zIndex:a.curtainZIndex}),i("body").append(e),this.each(function(){var n=i(this),t=i.meta?i.extend({},a,n.data()):a;this._$curtain=e,this._originalPosition=n.css("position").toLowerCase(),"absolute"!=this._originalPosition&&"fixed"!=this._originalPosition&&n.css("position","relative"),this._originalZIndex=n.css("z-index"),("auto"==this._originalZIndex||this._originalZIndex<=t.curtainZIndex)&&n.css("z-index",t.curtainZIndex+1)}),e.stop().animate({opacity:a.darkness},a.fadeInDuration,o),t.push({$curtain:e,$nodes:this}),this},i.fn.undim=function(a,o){var s=n(a,o);a=s.options,o=s.callback,a=i.extend({},i.fn.dimBackground.defaults,a);var e,r=[];if(this.each(function(){var n=i(this);i.meta&&i.extend({},a,n.data());this._$curtain&&(e||(e=this._$curtain),void 0!==this._originalPosition&&r.push([this,this._originalPosition,this._originalZIndex]),this._$curtain=void 0,this._originalPosition=void 0,this._originalZIndex=void 0)}),e){e.animate({opacity:0},a.fadeOutDuration,function(){for(var n=0;n<r.length;n++){var t=r[n][0],a=r[n][1],s=r[n][2];i(t).css({position:a,zIndex:s})}e.remove(),o()});for(var d,c=0;c<t.length;c++)if(t[c].$curtain==e){d=c;break}d&&(t=t.slice(0,c).concat(t.slice(c+1)))}return this},i.undim=function(a,o){var s=n(a,o);a=s.options,o=s.callback,a=i.extend({},i.fn.dimBackground.defaults,a);for(var e=t.slice(),r=0,d=e.length,c=0;c<t.length;c++)e[c].$nodes.undim(a,function(){++r==d&&o()});0===d&&o()},i.fn.dimBackground.defaults={darkness:.75,fadeInDuration:300,fadeOutDuration:300,curtainZIndex:999}}(jQuery);